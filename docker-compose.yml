services:
  ytm-downloader:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ytm-downloader
    environment:
      - OUTPUT_DIR=/downloads
      - MP3_QUALITY=${MP3_QUALITY:-0}
      - RATE_LIMIT=${RATE_LIMIT:-0}
      - MAX_RETRIES=${MAX_RETRIES:-3}
      - VERBOSE=${VERBOSE:-0}
      - LOG_FILE=${LOG_FILE:-/logs/ytm-downloader.log}
      - ARCHIVE_FILE=/downloads/download-archive.txt
      - WATCHDOG_INTERVAL=${WATCHDOG_INTERVAL:-600}
    volumes:
      - ./downloads:/downloads
      - ./logs:/logs
      - ./playlists.txt:/app/playlists.txt:ro
      - ./download-archive.txt:/downloads/download-archive.txt
    command: ["--watch","--interval","${WATCHDOG_INTERVAL:-600}","-f","/app/playlists.txt","-o","/downloads","--archive-file","/downloads/download-archive.txt","--log-file","/logs/ytm-downloader.log"]
    stop_signal: SIGINT
    restart: unless-stopped
